/*
  Xotic750
 @license {@link <http://www.gnu.org/licenses/gpl-3.0.html> GPL-3.0+}
 @module reiterate
*/
'use strict';(function(root,factory){if(typeof define==="function"&&define.amd)define([],factory);else if(typeof module==="object"&&module.exports)module.exports=factory();else{if(root.hasOwnProperty("reiterate"))throw new Error('Unable to define "reiterate"');Object.defineProperty(root,"reiterate",{enumerable:false,writable:true,configurable:true,value:factory()})}})(this,function(){var $={STRINGTAG:{ARRAY:Object.prototype.toString.call(Array.prototype),MAP:Object.prototype.toString.call(Map.prototype),
SET:Object.prototype.toString.call(Set.prototype),STRING:Object.prototype.toString.call(String.prototype),NUMBER:Object.prototype.toString.call(Number.prototype)},TYPE:{FUNCTION:typeof Function,UNDEFINED:typeof undefined},METHODDESCRIPTOR:{enumerable:false,writable:true,configurable:false,value:undefined},VARIABLEDESCRIPTOR:{enumerable:false,writable:true,configurable:false,value:undefined}},_={hasOwn:Function.call.bind(Object.prototype.hasOwnProperty),toStringTag:Function.call.bind(Object.prototype.toString),
Object:Object,setProperty:function(object,property,descriptor){Object.defineProperty(object,property,descriptor)},setMethod:function(object,property,method){if(_.hasOwn(object,property))throw new Error("property already exists on object");$.METHODDESCRIPTOR.value=method;_.setProperty(object,property,$.METHODDESCRIPTOR);return method},setVariable:function(object,property,value){$.VARIABLEDESCRIPTOR.value=value;_.setProperty(object,property,$.VARIABLEDESCRIPTOR);return value},isNil:function(subject){return subject==
null},toInteger:function(subject){var number=+subject,val=0;if(!Number.isNaN(number))if(!number||!Number.isFinite(number))val=number;else val=Math.sign(number)*Math.floor(Math.abs(number));return val},isNumber:function(subject){return _.toStringTag(subject)===$.STRINGTAG.NUMBER},clamp:function(number,min,max){if(!_.isNumber(number)||!_.isNumber(min)||!_.isNumber(max))throw new TypeError("argument is not of type number");return Math.min(Math.max(number,min),max)},toSafeInteger:function(subject){return _.clamp(_.toInteger(subject),
Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)},isUndefined:function(subject){return typeof subject===$.TYPE.UNDEFINED},isFunction:function(subject){return typeof subject===$.TYPE.FUNCTION},isString:function(subject){return _.toStringTag(subject)===$.STRINGTAG.STRING},isLength:function(subject){return _.toSafeInteger(subject)===subject&&subject>=0},isArrayLike:function(subject){return!_.isNil(subject)&&!_.isFunction(subject)&&_.isLength(subject.length)},isArray:function(subject,relaxed){var isA;
if(relaxed)isA=_.isArrayLike(subject)&&!_.isString(subject);else isA=Array.isArray(subject);return isA},lastIndex:function(subject){return _.isArrayLike(subject)&&_.toSafeInteger(subject.length-1)||0},isObject:function(subject){return _.Object(subject)===subject},isSurrogatePair:function(char1,char2){var result=false,code1,code2;if(char1&&char2&&_.isString(char1)&&_.isString(char2)){code1=char1.charCodeAt();if(code1>=55296&&code1<=56319){code2=char2.charCodeAt();if(code2>=56320&&code2<=57343)result=
true}}return result},mustBeFunction:function(subject){if(!_.isFunction(subject))throw new TypeError("argument must be a function");return subject},mustBeFunctionIfDefined:function(subject,name){if(!_.isUndefined(subject)&&!_.isFunction(subject))throw new TypeError("If not undefined, "+name+" must be a function");return subject},clampToSafeIntegerRange:function(subject){var num=+subject,val=0;if(!Number.isNaN(num))val=_.clamp(num,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);return val},isCircular:function(thisArg,
stack,value){if(stack.has(thisArg)||stack.has(value))throw new TypeError("circular object");return false}},p={toArray:function(mapFn,thisArg){var result,item;_.mustBeFunctionIfDefined(mapFn,"mapFn");for(item of this){if(!result)result=[];result.push(mapFn?mapFn.call(thisArg,this,item):item)}return result},uniqueGenerator:function*(){var seen,item;for(item of this){if(!seen)seen=new Set;if(!seen.has(item)){seen.add(item,true);yield item}}},flattenGenerator:function*(relaxed){var stack,object,value,
tail;for(object of this){if(_.isArray(object,relaxed))stack=(new Map).set(object,{index:0,prev:null});else yield object;while(stack&&stack.size){tail=stack.get(object);if(tail.index>=object.length){stack.delete(object);object=tail.prev}else{value=object[tail.index];if(_.isArray(value,relaxed)){_.isCircular(this,stack,value);stack.set(value,{index:0,prev:object});object=value}else yield value;tail.index+=1}}}},walkOwnGenerator:function*(){var stack=new Map,object,value,tail,key;for(object of this){if(_.isObject(object))stack.set(object,
{keys:Object.keys(object),index:0,prev:null});else yield object;while(stack.size){tail=stack.get(object);if(tail.index>=tail.keys.length){stack.delete(object);object=tail.prev}else{key=tail.keys[tail.index];value=object[key];if(_.isObject(value)){_.isCircular(this,stack,value);stack.set(value,{keys:Object.keys(value),index:0,prev:object});object=value}else yield value;tail.index+=1}}}},mapGenerator:function*(callback,thisArg){_.mustBeFunction(callback);for(var element of this)yield callback.call(thisArg,
element,this)},filterGenerator:function*(callback,thisArg){_.mustBeFunction(callback);for(var element of this)if(callback.call(thisArg,element,this))yield element},reduce:function(callback,initialValue){_.mustBeFunction(callback);for(var element of this)initialValue=callback(initialValue,element,this);return initialValue},forEach:function(callback,thisArg){_.mustBeFunction(callback);for(var element of this)callback.call(thisArg,element,this)},every:function(callback,thisArg){var result,element;_.mustBeFunction(callback);
result=true;for(element of this)if(!callback.call(thisArg,element,this)){result=false;break}return result},stringify:function(mapFn,thisArg){var result,item;_.mustBeFunctionIfDefined(mapFn,"mapFn");result="";for(item of this)result+=mapFn?mapFn.call(thisArg,this,item):item;return result},then:function(generator){var iterator;if(!_.isFunction(generator)){if(!_.isUndefined(generator))throw new TypeError("If not undefined, generator must be a function");iterator=this}else{iterator=generator(this);_.setMethod(iterator,
"filter",p.filterGenerator);_.setMethod(iterator,"map",p.mapGenerator);_.setMethod(iterator,"unique",p.uniqueGenerator);_.setMethod(iterator,"iterate",iterateGenerator);_.setMethod(iterator,"enumerate",EnumerateGenerator);_.setMethod(iterator,"then",p.then);_.setMethod(iterator,"toArray",p.toArray);_.setMethod(iterator,"stringify",p.stringify);_.setMethod(iterator,"flatten",p.flattenGenerator);_.setMethod(iterator,"reduce",p.reduce);_.setMethod(iterator,"forEach",p.forEach);_.setMethod(iterator,"every",
p.every)}return iterator}};function*countReverseGenerator(opts){var count=opts.to;if(opts.to<=opts.from)while(count<=opts.from){yield count;count+=opts.by}else while(count>=opts.from){yield count;count-=opts.by}}function*countForwardGenerator(opts){var count=opts.from;if(opts.from<=opts.to)while(count<=opts.to){yield count;count+=opts.by}else while(count>=opts.to){yield count;count-=opts.by}}function*countGenerator(opts){if(opts.reversed)yield*countReverseGenerator(opts);else yield*countForwardGenerator(opts)}
function setReverseGenerator(opts,generator){if(opts.reversed)generator.reverse();return generator}function CounterGenerator(){if(!(this instanceof CounterGenerator))return new CounterGenerator;var opts={reversed:false,from:0,to:Number.MAX_SAFE_INTEGER,by:1};_.setMethod(this,"state",function(){return{reversed:opts.reversed,from:opts.from,to:opts.to,by:opts.by}});_.setMethod(this,Symbol.iterator,function(){return countGenerator(this.state())});_.setMethod(this,"from",function(number){opts.from=_.clampToSafeIntegerRange(number);
return this});_.setMethod(this,"to",function(number){opts.to=_.clampToSafeIntegerRange(number);return this});_.setMethod(this,"by",function(number){opts.by=Math.abs(_.clampToSafeIntegerRange(number));if(!opts.by)throw new TypeError("can not count by zero");return this});_.setMethod(this,"reverse",function(){opts.reversed=!opts.reversed;return this})}_.setMethod(CounterGenerator.prototype,"map",p.mapGenerator);_.setMethod(CounterGenerator.prototype,"filter",p.filterGenerator);_.setMethod(CounterGenerator.prototype,
"toArray",p.toArray);_.setMethod(CounterGenerator.prototype,"then",p.then);_.setMethod(CounterGenerator.prototype,"reduce",p.reduce);_.setMethod(CounterGenerator.prototype,"forEach",p.forEach);function getYieldValue(opts,object,key){var result,value;if(opts.keys)result=key;else{value=object[key];if(opts.values)result=value;else result=[key,value]}return result}function*arrayGenerator(subject,opts){var generator=new CounterGenerator,key;setReverseGenerator(opts,generator.to(_.lastIndex(subject)));
for(key of generator)yield getYieldValue(opts,subject,key)}function ArrayGenerator(subject){if(!(this instanceof ArrayGenerator))return new ArrayGenerator(subject);var opts={reversed:false,entries:true,values:false,keys:false};_.setMethod(this,"state",function(){return{reversed:opts.reversed,entries:opts.entries,values:opts.values,keys:opts.keys}});_.setMethod(this,Symbol.iterator,function(){return arrayGenerator(subject,this.state())});_.setMethod(this,"entries",function(){opts.entries=true;opts.values=
false;opts.keys=false;return this});_.setMethod(this,"values",function(){opts.entries=false;opts.values=true;opts.keys=false;return this});_.setMethod(this,"keys",function(){opts.entries=false;opts.values=false;opts.keys=true;return this});_.setMethod(this,"reverse",function(){opts.reversed=!opts.reversed;return this})}_.setMethod(ArrayGenerator.prototype,"map",p.mapGenerator);_.setMethod(ArrayGenerator.prototype,"filter",p.filterGenerator);_.setMethod(ArrayGenerator.prototype,"toArray",p.toArray);
_.setMethod(ArrayGenerator.prototype,"then",p.then);_.setMethod(ArrayGenerator.prototype,"unique",p.uniqueGenerator);_.setMethod(ArrayGenerator.prototype,"flatten",p.flattenGenerator);_.setMethod(ArrayGenerator.prototype,"reduce",p.reduce);_.setMethod(ArrayGenerator.prototype,"forEach",p.forEach);_.setMethod(ArrayGenerator.prototype,"every",p.every);function getStringYieldValue(opts,character,key){var value,result;if(opts.keys)result=key;else{value=String.fromCodePoint(character.codePointAt(0));if(opts.values)result=
value;else result=[key,value]}return result}function*stringGenerator(subject,opts){var generator=new CounterGenerator(opts),next=true,char1,char2,key;setReverseGenerator(opts,generator.to(_.lastIndex(subject)));for(key of generator)if(next)if(opts.reversed){char1=subject[key-1];char2=subject[key];next=!_.isSurrogatePair(char1,char2);if(next)yield getStringYieldValue(opts,char2,key)}else{char1=subject[key];char2=subject[key+1];next=!_.isSurrogatePair(char1,char2);yield getStringYieldValue(opts,char1+
char2,key)}else{next=!next;if(opts.reversed)yield getStringYieldValue(opts,char1+char2,key)}}function StringGenerator(subject){if(!(this instanceof StringGenerator))return new StringGenerator(subject);var opts={reversed:false,entries:true,values:false,keys:false};_.setMethod(this,"state",function(){return{reversed:opts.reversed,entries:opts.entries,values:opts.values,keys:opts.keys}});_.setMethod(this,Symbol.iterator,function(){return stringGenerator(subject,this.state())});_.setMethod(this,"entries",
function(){opts.entries=true;opts.values=false;opts.keys=false;return this});_.setMethod(this,"values",function(){opts.entries=false;opts.values=true;opts.keys=false;return this});_.setMethod(this,"keys",function(){opts.entries=false;opts.values=false;opts.keys=true;return this});_.setMethod(this,"reverse",function(){opts.reversed=!opts.reversed;return this})}_.setMethod(StringGenerator.prototype,"map",p.mapGenerator);_.setMethod(StringGenerator.prototype,"filter",p.filterGenerator);_.setMethod(StringGenerator.prototype,
"toArray",p.toArray);_.setMethod(StringGenerator.prototype,"then",p.then);_.setMethod(StringGenerator.prototype,"unique",p.uniqueGenerator);_.setMethod(StringGenerator.prototype,"stringify",p.stringify);_.setMethod(StringGenerator.prototype,"reduce",p.reduce);_.setMethod(StringGenerator.prototype,"forEach",p.forEach);_.setMethod(StringGenerator.prototype,"every",p.every);function*enumerateGenerator(subject,opts){for(var key in subject)if(!opts.own||_.hasOwn(subject,key))yield getYieldValue(opts,subject,
key)}function EnumerateGenerator(subject){if(!(this instanceof EnumerateGenerator))return new EnumerateGenerator(subject);var opts={entries:true,values:false,keys:false,own:false};_.setMethod(this,"state",function(){return{entries:opts.entries,values:opts.values,keys:opts.keys,own:opts.own}});_.setMethod(this,Symbol.iterator,function(){return enumerateGenerator(subject,this.state())});_.setMethod(this,"entries",function(){opts.entries=true;opts.values=false;opts.keys=false;return this});_.setMethod(this,
"values",function(){opts.entries=false;opts.values=true;opts.keys=false;return this});_.setMethod(this,"keys",function(){opts.entries=false;opts.values=false;opts.keys=true;return this});_.setMethod(this,"own",function(){opts.own=!opts.own;return this})}_.setMethod(EnumerateGenerator.prototype,"map",p.mapGenerator);_.setMethod(EnumerateGenerator.prototype,"filter",p.filterGenerator);_.setMethod(EnumerateGenerator.prototype,"toArray",p.toArray);_.setMethod(EnumerateGenerator.prototype,"then",p.then);
_.setMethod(EnumerateGenerator.prototype,"unique",p.uniqueGenerator);_.setMethod(EnumerateGenerator.prototype,"flatten",p.flattenGenerator);_.setMethod(EnumerateGenerator.prototype,"stringify",p.stringify);_.setMethod(EnumerateGenerator.prototype,"reduce",p.reduce);_.setMethod(EnumerateGenerator.prototype,"forEach",p.forEach);_.setMethod(EnumerateGenerator.prototype,"every",p.every);function*mapObjectGenerator(){if(true)throw new Error("not yet");yield undefined}function*setObjectGenerator(){if(true)throw new Error("not yet");
yield undefined}function*iterateGenerator(relaxed){var value,tag;for(value of this)if(_.isArray(value,relaxed))yield*new ArrayGenerator(value);else if(_.isString(value))yield*new StringGenerator(value);else{tag=_.toStringTag(value);if(tag===$.MAPTAG)yield*mapObjectGenerator(value);else if(tag===$.SETTAG)yield*setObjectGenerator(value)}}function addMethods(object){_.setMethod(object,"filter",p.filterGenerator);_.setMethod(object,"map",p.mapGenerator);_.setMethod(object,"unique",p.uniqueGenerator);
_.setMethod(object,"iterate",iterateGenerator);_.setMethod(object,"enumerate",EnumerateGenerator);_.setMethod(object,"then",p.then);_.setMethod(object,"toArray",p.toArray);_.setMethod(object,"flatten",p.flattenGenerator);_.setMethod(object,"reduce",p.reduce);_.setMethod(object,"forEach",p.forEach);_.setMethod(object,"every",p.every)}addMethods(p.mapGenerator.prototype);addMethods(p.filterGenerator.prototype);addMethods(p.uniqueGenerator.prototype);addMethods(p.flattenGenerator.prototype);addMethods(iterateGenerator.prototype);
function makeCounterGenerator(subject,to,by){var generator=new CounterGenerator;if(_.isNumber(subject)){if(_.isNil(to))generator.to(subject);else generator.from(subject).to(to);if(!_.isNil(by))generator.by(by)}return generator}function makeOtherGenerators(subject){var tag=_.toStringTag(subject),generator;if(tag===$.MAPTAG)generator=mapObjectGenerator(subject);else if(tag===$.SETTAG)generator=setObjectGenerator(subject);else generator=new EnumerateGenerator(subject);return generator}return function Reiterate(subject,
to,by){if(!(this instanceof Reiterate))return new Reiterate(subject,to,by);var generator;if(_.isNil(subject)||_.isNumber(subject))generator=makeCounterGenerator(subject,to,by);else if(_.isArray(subject,to))generator=new ArrayGenerator(subject);else if(_.isString(subject))generator=new StringGenerator(subject);else generator=makeOtherGenerators(subject);return generator}});
