/*
  Xotic750
 @license {@link <http://www.gnu.org/licenses/gpl-3.0.html> GPL-3.0+}
 @module reiterate
*/
'use strict';(function(root,factory){if(typeof define==="function"&&define.amd)define([],factory);else if(typeof module==="object"&&module.exports)module.exports=factory();else{if(root.hasOwnProperty("reiterate"))throw new Error('Unable to define "reiterate"');Object.defineProperty(root,"reiterate",{enumerable:false,writable:true,configurable:true,value:factory()})}})(this,function(){var Reiterate,$={STRINGTAG:{ARRAY:Object.prototype.toString.call(Array.prototype),MAP:Object.prototype.toString.call(Map.prototype),
SET:Object.prototype.toString.call(Set.prototype),STRING:Object.prototype.toString.call(String.prototype),NUMBER:Object.prototype.toString.call(Number.prototype)},TYPE:{OBJECT:typeof Object.prototype,FUNCTION:typeof Function,UNDEFINED:typeof undefined},VALUEDESCRIPTOR:{enumerable:false,writable:true,configurable:true},OPTS:{ENTRIES:{entries:true,values:false,keys:false},VALUES:{entries:false,values:true,keys:false},KEYS:{entries:false,values:false,keys:true}}},_={hasOwn:Function.call.bind(Object.prototype.hasOwnProperty),
toStringTag:Function.call.bind(Object.prototype.toString),setValue:function(object,property,value){if(_.hasOwn(object,property))throw new Error("property already exists on object");var descriptor=_.assign({},$.VALUEDESCRIPTOR);descriptor.value=value;return Object.defineProperty(object,property,descriptor)},isNil:function(subject){return subject==null},toInteger:function(subject){var number=+subject,val=0;if(!Number.isNaN(number))if(!number||!Number.isFinite(number))val=number;else val=Math.sign(number)*
Math.floor(Math.abs(number));return val},isNumber:function(subject){return _.toStringTag(subject)===$.STRINGTAG.NUMBER},clamp:function(number,min,max){return Math.min(Math.max(number,min),max)},toSafeInteger:function(subject){return _.clamp(_.toInteger(subject),Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)},isUndefined:function(subject){return typeof subject===$.TYPE.UNDEFINED},isFunction:function(subject){return typeof subject===$.TYPE.FUNCTION},isString:function(subject){return _.toStringTag(subject)===
$.STRINGTAG.STRING},isLength:function(subject){return _.toSafeInteger(subject)===subject&&subject>=0},isArrayLike:function(subject){return!_.isNil(subject)&&!_.isFunction(subject)&&_.isLength(subject.length)},isArray:function(subject,relaxed){var isA;if(relaxed)isA=_.isArrayLike(subject)&&!_.isString(subject);else isA=Array.isArray(subject);return isA},isSurrogatePair:function(char1,char2){var result=false,code1,code2;if(char1&&char2&&_.isString(char1)&&_.isString(char2)){code1=char1.charCodeAt();
if(code1>=55296&&code1<=56319){code2=char2.charCodeAt();if(code2>=56320&&code2<=57343)result=true}}return result},mustBeFunction:function(subject){if(!_.isFunction(subject))throw new TypeError("argument must be a function");return subject},mustBeFunctionIfDefined:function(subject,name){if(!_.isUndefined(subject)&&!_.isFunction(subject))throw new TypeError("If not undefined, "+name+" must be a function");return subject},clampToSafeIntegerRange:function(subject){var num=+subject,v=0;if(!Number.isNaN(num))v=
_.clamp(num,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER);return v},toLength:function(subject){return _.clamp(_.toInteger(subject),0,Number.MAX_SAFE_INTEGER)},isObject:function(subject){var type=typeof subject;return!!subject&&(type===$.TYPE.OBJECT||type===$.TYPE.FUNCTION)},throwIfCircular:function(stack,value){if(stack.has(value))throw new TypeError("circular object");return false},setReverseIfOpt:function(opts,generator){if(opts.reversed)generator.reverse();return generator},assign:function(){function assignFromSource(from,
to){var keys=Object.keys(from),len=keys.length,index=0,key;while(index<len){key=keys[index];if(_.hasOwn(from,key))to[key]=from[key];index+=1}}return function(target){var length=arguments.length,index,arg;if(length>=2){index=1;while(index<length){arg=arguments[index];if(!_.isNil(arg))assignFromSource(arg,target);index+=1}}return target}}(),getYieldValue:function(opts,object,key){var result,value;if(opts.keys)result=key;else{value=object[key];if(opts.values)result=value;else result=[key,value]}return result},
addMethods:function(object){if(object!==g.repeatGenerator.prototype){_.setValue(object,"filter",p.filterGenerator);_.setValue(object,"map",p.mapGenerator);_.setValue(object,"every",p.every);_.setValue(object,"some",p.some);_.setValue(object,"drop",p.dropGenerator);_.setValue(object,"dropWhile",p.dropWhileGenerator);_.setValue(object,"difference",p.differenceGenerator)}_.setValue(object,"take",p.takeGenerator);_.setValue(object,"takeWhile",p.takeWhileGenerator);_.setValue(object,"reduce",p.reduce);
_.setValue(object,"tap",p.tapGenerator);_.setValue(object,"join",p.join);_.setValue(object,"then",p.then);_.setValue(object,"chunk",p.chunkGenerator);_.setValue(object,"valueOf",p.valueOf);_.setValue(object,"toString",p.toString);_.setValue(object,"asString",p.asString);_.setValue(object,"asObject",p.asObject);_.setValue(object,"asMap",p.asMap);_.setValue(object,"initial",p.initialGenerator);if(object!==g.CounterGenerator.prototype){_.setValue(object,"enumerate",g.EnumerateGenerator);_.setValue(object,
"unique",p.uniqueGenerator);_.setValue(object,"flatten",p.flattenGenerator)}if(object!==g.repeatGenerator.prototype&&object!==g.CounterGenerator.prototype)_.setValue(object,"compact",p.compactGenerator);if(object===p.uniqueGenerator.prototype)_.setValue(object,"asSet",p.asSet)},populatePrototypes:function(){_.addMethods(g.CounterGenerator.prototype);_.addMethods(g.ArrayGenerator.prototype);_.addMethods(g.StringGenerator.prototype);_.addMethods(g.EnumerateGenerator.prototype);_.addMethods(g.repeatGenerator.prototype);
_.addMethods(p.mapGenerator.prototype);_.addMethods(p.filterGenerator.prototype);_.addMethods(p.uniqueGenerator.prototype);_.addMethods(p.flattenGenerator.prototype);_.addMethods(p.dropGenerator.prototype);_.addMethods(p.dropWhileGenerator.prototype);_.addMethods(p.takeGenerator.prototype);_.addMethods(p.takeWhileGenerator.prototype);_.addMethods(p.tapGenerator.prototype);_.addMethods(p.chunkGenerator.prototype);_.addMethods(p.compactGenerator.prototype);_.addMethods(p.differenceGenerator.prototype);
_.addMethods(p.initialGenerator.prototype)},setIndexesOpts:function(start,end,opts){opts.from=_.toInteger(start);if(opts.from<0)opts.from=Math.max(opts.length+opts.from,0);else opts.from=Math.min(opts.from,opts.length);if(_.isUndefined(end))opts.to=opts.length;else opts.to=_.toInteger(end);if(opts.to<0)opts.to=Math.max(opts.length+opts.to,0);else opts.to=Math.min(opts.to,opts.length);opts.to=_.toLength(opts.to)-1}},p={reduce:function(callback,initialValue){var index,supplied,assigned,element;_.mustBeFunction(callback);
if(arguments.length>1)supplied=true;index=0;for(element of this){if(!supplied&&!assigned){initialValue=element;assigned=true}else initialValue=callback(initialValue,element,index);index+=1}return initialValue},tapGenerator:function*(callback,thisArg){var index,element;_.mustBeFunction(callback);index=0;for(element of this){callback.call(thisArg,element,index);yield element;index+=1}},every:function(callback,thisArg){var index,result,element;_.mustBeFunction(callback);index=0;result=true;for(element of this){if(!callback.call(thisArg,
element,index)){result=false;break}index+=1}return result},some:function(callback,thisArg){var index,result,element;_.mustBeFunction(callback);index=0;result=false;for(element of this){if(callback.call(thisArg,element,index)){result=true;break}index+=1}return result},valueOf:function(){var result=[],item;for(item of this)result.push(item);return result},join:function(seperator){var result="",iterator=this[Symbol.iterator](),item=iterator.next(),next;if(_.isUndefined(seperator))seperator=",";while(!item.done){result+=
item.value;next=iterator.next();if(!next.done)result+=seperator;item=next}return result},toString:function(){return this.join()},asString:function(){return this.join("")},asObject:function(){var result={},index=0,item;for(item of this){result[index]=item;index+=1}return _.setValue(result,"length",index)},asMap:function(){var result=new Map,index=0,item;for(item of this){result.set(index,item);index+=1}return result},asSet:function(){var result=new Set,item;for(item of this)result.add(item);return result},
dropGenerator:function*(number){var index=0,length=_.toLength(number),item;for(item of this){if(index>=length)yield item;index+=1}},dropWhileGenerator:function*(callback,thisArg){var index,item,drop;_.mustBeFunction(callback);drop=true;index=0;for(item of this){if(drop)drop=callback.call(thisArg,item,index);if(!drop)yield item;index+=1}},takeGenerator:function*(number){var length=_.toLength(number),index,item;if(!length)return;index=0;for(item of this){if(index<length)yield item;else break;index+=
1}},takeWhileGenerator:function*(callback,thisArg){var index,item,take;_.mustBeFunction(callback);take=true;index=0;for(item of this){if(take)take=callback.call(thisArg,item,index);if(take)yield item;else break;index+=1}},chunkGenerator:function*(size){var length=_.toLength(size)||1,chunk=[],item;for(item of this)if(chunk.length<length)chunk.push(item);else{yield chunk;chunk=[item]}if(chunk)yield chunk},compactGenerator:function*(){for(var item of this)if(item)yield item},differenceGenerator:function*(values){var vals=
new Set,item;for(item of(new Reiterate(values)).values())vals.add(item);for(item of this)if(!vals.has(item))yield item;vals.clear()},initialGenerator:function*(){var iterator=this[Symbol.iterator](),item=iterator.next(),next;while(!item.done){next=iterator.next();if(!next.done)yield item.value;item=next}},uniqueGenerator:function*(){var seen=new Set,item;for(item of this)if(!seen.has(item)){yield item;seen.add(item)}seen.clear()},flattenGenerator:function(){function setStack(stack,current,previous){return stack.set(current,
{index:0,prev:previous})}function*iterateStack(stack,object,relaxed){var tail,value;while(stack&&stack.size){tail=stack.get(object);if(tail.index>=object.length){stack.delete(object);object=tail.prev}else{value=object[tail.index];if(_.isArray(value,relaxed)){_.throwIfCircular(stack,value);setStack(stack,value,object);object=value}else yield value;tail.index+=1}}}return function*(relaxed){var stack=new Map,object;for(object of this){if(_.isArray(object,relaxed))setStack(stack,object,null);else yield object;
yield*iterateStack(stack,object,relaxed)}stack.clear()}}(),mapGenerator:function*(callback,thisArg){_.mustBeFunction(callback);for(var element of this)yield callback.call(thisArg,element,this)},filterGenerator:function*(callback,thisArg){_.mustBeFunction(callback);for(var element of this)if(callback.call(thisArg,element,this))yield element},then:function(generator){var iterator;if(!_.isFunction(generator)){_.mustBeFunctionIfDefined(generator,"generator");iterator=this}else{iterator=generator(this);
_.addMethods(iterator)}return iterator}},g={CounterGenerator:function(){function*countReverseGenerator(opts){var count=opts.to;if(opts.to<=opts.from)while(count<=opts.from){yield count;count+=opts.by}else while(count>=opts.from){yield count;count-=opts.by}}function*countForwardGenerator(opts){var count=opts.from;if(opts.from<=opts.to)while(count<=opts.to){yield count;count+=opts.by}else while(count>=opts.to){yield count;count-=opts.by}}function*countGenerator(opts){if(opts.reversed)yield*countReverseGenerator(opts);
else yield*countForwardGenerator(opts)}function CounterGenerator(){if(!(this instanceof CounterGenerator))return new CounterGenerator;var opts={reversed:false,from:0,to:Number.MAX_SAFE_INTEGER,by:1};_.setValue(this,"state",function(){return _.assign({},opts)});_.setValue(this,Symbol.iterator,function(){return countGenerator(_.assign({},opts))});_.setValue(this,"from",function(number){opts.from=_.clampToSafeIntegerRange(number);return this});_.setValue(this,"to",function(number){opts.to=_.clampToSafeIntegerRange(number);
return this});_.setValue(this,"by",function(number){opts.by=Math.abs(_.clampToSafeIntegerRange(number));if(!opts.by)throw new TypeError("can not count by zero");return this});_.setValue(this,"reverse",function(){opts.reversed=!opts.reversed;return this})}return CounterGenerator}(),ArrayGenerator:function(){function*arrayGenerator(subject,opts){var generator,key;if(!opts.length)return;generator=g.CounterGenerator();generator.from(opts.from).to(opts.to).by(opts.by);_.setReverseIfOpt(opts,generator);
for(key of generator)yield _.getYieldValue(opts,subject,key)}function ArrayGenerator(subject){if(!(this instanceof ArrayGenerator))return new ArrayGenerator(subject);var length=_.isArrayLike(subject)?subject.length:0,opts=_.assign({length:length,reversed:false,from:0,to:length-1,by:1},$.OPTS.ENTRIES);_.setValue(this,"state",function(){return _.assign({},opts)});_.setValue(this,Symbol.iterator,function(){return arrayGenerator(subject,_.assign({},opts))});_.setValue(this,"entries",function(){_.assign(opts,
$.OPTS.ENTRIES);return this});_.setValue(this,"values",function(){_.assign(opts,$.OPTS.VALUES);return this});_.setValue(this,"keys",function(){_.assign(opts,$.OPTS.KEYS);return this});_.setValue(this,"reverse",function(){opts.reversed=!opts.reversed;return this});_.setValue(this,"slice",function(start,end){_.setIndexesOpts(start,end,opts);return this})}return ArrayGenerator}(),StringGenerator:function(){function getStringYieldValue(opts,character,key){var value,result;if(opts.keys)result=key;else{value=
String.fromCodePoint(character.codePointAt());if(opts.values)result=value;else result=[key,value]}return result}function*stringGenerator(subject,opts){var generator,next,char1,char2,key;if(!opts.length)return;next=true;generator=g.CounterGenerator(opts);generator.from(opts.from).to(opts.to).by(opts.by);_.setReverseIfOpt(opts,generator);for(key of generator)if(next)if(opts.reversed){char1=subject[key-1];char2=subject[key];next=!_.isSurrogatePair(char1,char2);if(next)yield getStringYieldValue(opts,
char2,key)}else{char1=subject[key];char2=subject[key+1];next=!_.isSurrogatePair(char1,char2);yield getStringYieldValue(opts,char1+char2,key)}else{next=!next;if(opts.reversed)yield getStringYieldValue(opts,char1+char2,key)}}function StringGenerator(subject){if(!(this instanceof StringGenerator))return new StringGenerator(subject);var length=_.isArrayLike(subject)?subject.length:0,opts=_.assign({length:length,reversed:false,from:0,to:length-1,by:1},$.OPTS.ENTRIES);_.setValue(this,"state",function(){return _.assign({},
opts)});_.setValue(this,Symbol.iterator,function(){return stringGenerator(subject,_.assign({},opts))});_.setValue(this,"entries",function(){_.assign(opts,$.OPTS.ENTRIES);return this});_.setValue(this,"values",function(){_.assign(opts,$.OPTS.VALUES);return this});_.setValue(this,"keys",function(){_.assign(opts,$.OPTS.KEYS);return this});_.setValue(this,"reverse",function(){opts.reversed=!opts.reversed;return this});_.setValue(this,"slice",function(start,end){var char1,char2;_.setIndexesOpts(start,
end,opts);if(opts.from){char1=subject[opts.from-1];char2=subject[opts.from];if(_.isSurrogatePair(char1,char2))opts.from+=1}if(opts.to){char1=subject[opts.to-1];char2=subject[opts.to];if(_.isSurrogatePair(char1,char2))opts.to-=1}return this})}return StringGenerator}(),EnumerateGenerator:function(){function*enumerateGenerator(subject,opts){for(var key in subject)if(!opts.own||_.hasOwn(subject,key))yield _.getYieldValue(opts,subject,key)}function EnumerateGenerator(subject){if(!(this instanceof EnumerateGenerator))return new EnumerateGenerator(subject);
var opts=_.assign({own:false},$.OPTS.ENTRIES);_.setValue(this,"state",function(){return _.assign({},opts)});_.setValue(this,Symbol.iterator,function(){return enumerateGenerator(subject,_.assign({},opts))});_.setValue(this,"entries",function(){_.assign(opts,$.OPTS.ENTRIES);return this});_.setValue(this,"values",function(){_.assign(opts,$.OPTS.VALUES);return this});_.setValue(this,"keys",function(){_.assign(opts,$.OPTS.KEYS);return this});_.setValue(this,"own",function(){opts.own=!opts.own;return this})}
return EnumerateGenerator}(),repeatGenerator:function*(subject){do yield subject;while(true)}};_.populatePrototypes();return function(){function makeCounterGenerator(subject,to,by){var generator=g.CounterGenerator();if(_.isNumber(subject)){if(_.isNil(to))generator.to(subject);else generator.from(subject).to(to);if(!_.isNil(by))generator.by(by)}return generator}Reiterate=function(subject,to,by){if(!(this instanceof Reiterate))return new Reiterate(subject,to,by);var generator;if(_.isNil(subject)||_.isNumber(subject))generator=
makeCounterGenerator(subject,to,by);else if(_.isArray(subject,to))generator=g.ArrayGenerator(subject);else if(_.isString(subject))generator=g.StringGenerator(subject);else if(_.isObject(Symbol)&&_.isFunction(subject[Symbol.iterator])){generator=subject[Symbol.iterator]();_.addMethods(generator)}else generator=g.EnumerateGenerator(subject);return generator};_.setValue(Reiterate,"array",g.ArrayGenerator);_.setValue(Reiterate,"string",g.StringGenerator);_.setValue(Reiterate,"enumerate",g.EnumerateGenerator);
_.setValue(Reiterate,"repeat",g.repeatGenerator);return Reiterate}()});
